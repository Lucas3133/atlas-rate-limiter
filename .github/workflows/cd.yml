# ================================================================
# ATLAS RATE LIMITER - CONTINUOUS DEPLOYMENT
# ================================================================
# Deploy autom√°tico para Render quando push na main
# ================================================================

name: CD - Deploy to Render

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Permite deploy manual

jobs:
  # ============================================================
  # NOTIFICAR RENDER PARA FAZER DEPLOY
  # ============================================================
  deploy:
    name: üöÄ Deploy to Render
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
      
      - name: üöÄ Trigger Render Deploy
        env:
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          if [ -z "$RENDER_DEPLOY_HOOK_URL" ]; then
            echo "‚ö†Ô∏è RENDER_DEPLOY_HOOK_URL n√£o configurado"
            echo "Configure o secret RENDER_DEPLOY_HOOK_URL no GitHub"
            exit 0
          fi
          
          echo "üöÄ Disparando deploy no Render..."
          curl -X POST "$RENDER_DEPLOY_HOOK_URL"
          echo "‚úÖ Deploy iniciado com sucesso!"
      
      - name: üí¨ Deploy Status
        run: |
          echo "=================================="
          echo "üéâ Deploy em progresso!"
          echo "Acesse: https://dashboard.render.com"
          echo "=================================="

  # ============================================================
  # NOTIFICA√á√ÉO DE SUCESSO
  # ============================================================
  notify:
    name: üì¢ Notify Success
    runs-on: ubuntu-latest
    needs: deploy
    if: success()
    
    steps:
      - name: ‚úÖ Success Notification
        run: |
          echo "=================================="
          echo "‚úÖ CI/CD CONCLU√çDO COM SUCESSO!"
          echo "=================================="
          echo "üì¶ Commit: ${{ github.sha }}"
          echo "üë§ Autor: ${{ github.actor }}"
          echo "üåø Branch: ${{ github.ref }}"
          echo "=================================="
