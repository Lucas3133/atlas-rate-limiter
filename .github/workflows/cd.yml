# ================================================================
# ATLAS RATE LIMITER - CONTINUOUS DEPLOYMENT
# ================================================================
# Automatic deploy to Render when pushing to main
# ================================================================

name: CD - Deploy to Render

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Allows manual deploy

jobs:
  # ============================================================
  # NOTIFY RENDER TO DEPLOY
  # ============================================================
  deploy:
    name: üöÄ Deploy to Render
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
      
      - name: üöÄ Trigger Render Deploy
        env:
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          if [ -z "$RENDER_DEPLOY_HOOK_URL" ]; then
            echo "‚ö†Ô∏è RENDER_DEPLOY_HOOK_URL not configured"
            echo "Configure the RENDER_DEPLOY_HOOK_URL secret in GitHub"
            exit 0
          fi
          
          echo "üöÄ Triggering deploy on Render..."
          curl -X POST "$RENDER_DEPLOY_HOOK_URL"
          echo "‚úÖ Deploy started successfully!"
      
      - name: üí¨ Deploy Status
        run: |
          echo "=================================="
          echo "üéâ Deploy in progress!"
          echo "Access: https://dashboard.render.com"
          echo "=================================="

  # ============================================================
  # SUCCESS NOTIFICATION
  # ============================================================
  notify:
    name: üì¢ Notify Success
    runs-on: ubuntu-latest
    needs: deploy
    if: success()
    
    steps:
      - name: ‚úÖ Success Notification
        run: |
          echo "=================================="
          echo "‚úÖ CI/CD COMPLETED SUCCESSFULLY!"
          echo "=================================="
          echo "üì¶ Commit: ${{ github.sha }}"
          echo "üë§ Author: ${{ github.actor }}"
          echo "üåø Branch: ${{ github.ref }}"
          echo "=================================="
