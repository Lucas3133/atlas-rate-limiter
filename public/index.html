<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Atlas Rate Limiter - Real-time monitoring dashboard">
    <title>üõ°Ô∏è Atlas Rate Limiter</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --dark: #0f172a;
            --darker: #020617;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--darker);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            animation: bgPulse 15s ease-in-out infinite;
        }

        @keyframes bgPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Floating Orbs */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: var(--primary);
            top: -100px;
            left: -100px;
        }

        .orb-2 {
            width: 300px;
            height: 300px;
            background: var(--secondary);
            bottom: -50px;
            right: -50px;
            animation-delay: -5s;
        }

        .orb-3 {
            width: 200px;
            height: 200px;
            background: var(--success);
            top: 50%;
            left: 50%;
            animation-delay: -10s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(30px, -30px) scale(1.1);
            }

            50% {
                transform: translate(-20px, 20px) scale(0.95);
            }

            75% {
                transform: translate(20px, 10px) scale(1.05);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 10px;
            display: inline-block;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 50%, #8b5cf6 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Status Badges Row */
        .status-row {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 12px 24px;
            border-radius: 50px;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }

        .status-dot.healthy {
            background: var(--success);
            box-shadow: 0 0 20px var(--success);
        }

        .status-dot.warning {
            background: var(--warning);
            box-shadow: 0 0 20px var(--warning);
        }

        .status-dot.danger {
            background: var(--danger);
            box-shadow: 0 0 20px var(--danger);
        }

        .status-dot.critical {
            background: #dc2626;
            box-shadow: 0 0 20px #dc2626;
            animation: criticalPulse 0.5s ease-in-out infinite;
        }

        @keyframes criticalPulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Threat Level Badge */
        .threat-badge {
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .threat-badge.low {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .threat-badge.medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .threat-badge.high {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .threat-badge.critical {
            background: rgba(220, 38, 38, 0.3);
            color: #fca5a5;
            border: 1px solid #dc2626;
            animation: criticalPulse 1s ease-in-out infinite;
        }

        /* Stats Grid - METRIC-ADV-001 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .stat-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .stat-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .stat-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .stat-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff, var(--primary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-value.success {
            background: linear-gradient(135deg, #fff, var(--success));
            background-clip: text;
            -webkit-background-clip: text;
        }

        .stat-value.danger {
            background: linear-gradient(135deg, #fff, var(--danger));
            background-clip: text;
            -webkit-background-clip: text;
        }

        .stat-value.warning {
            background: linear-gradient(135deg, #fff, var(--warning));
            background-clip: text;
            -webkit-background-clip: text;
        }

        .stat-value.info {
            background: linear-gradient(135deg, #fff, var(--info));
            background-clip: text;
            -webkit-background-clip: text;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Live Counters Section */
        .live-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.5s backwards;
        }

        .live-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .live-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(239, 68, 68, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #fca5a5;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: blink 1s ease-in-out infinite;
        }

        .counters {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 800px) {
            .counters {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .counters {
                grid-template-columns: 1fr;
            }
        }

        .counter {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .counter:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: scale(1.02);
        }

        .counter-value {
            font-size: 2.5rem;
            font-weight: 800;
            font-variant-numeric: tabular-nums;
            transition: all 0.3s ease;
        }

        .counter-value.updating {
            transform: scale(1.1);
        }

        .counter-label {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            margin-top: 8px;
        }

        .counter.allowed .counter-value {
            color: var(--success);
        }

        .counter.blocked .counter-value {
            color: var(--danger);
        }

        .counter.threats .counter-value {
            color: #f472b6;
        }

        .counter.health .counter-value {
            color: var(--info);
        }

        /* Fail-Open Warning */
        .fail-open-warning {
            display: none;
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        .fail-open-warning.visible {
            display: flex;
        }

        .fail-open-warning-icon {
            font-size: 1.5rem;
            margin-right: 12px;
        }

        .fail-open-warning-text {
            flex: 1;
        }

        .fail-open-warning-title {
            color: var(--warning);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .fail-open-warning-desc {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Endpoints Section */
        .endpoints-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.6s backwards;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .endpoint {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .endpoint:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary);
            transform: translateX(8px);
        }

        .method {
            padding: 6px 14px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.75rem;
            margin-right: 16px;
            min-width: 55px;
            text-align: center;
            text-transform: uppercase;
        }

        .method.get {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .method.post {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .endpoint-info {
            flex: 1;
        }

        .endpoint-path {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 1rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .endpoint-desc {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        .endpoint-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .endpoint:hover .endpoint-arrow {
            color: var(--primary);
            transform: translateX(5px);
        }

        /* Action Buttons */
        .actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out 0.7s backwards;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: #fff;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--glass-border);
            color: #fff;
        }

        .btn-outline:hover {
            background: var(--glass);
            border-color: var(--primary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal {
            background: var(--dark);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #fff;
        }

        .response-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .response-status.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .response-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .response-details {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.5);
        }

        .detail-value {
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
            animation: fadeInUp 0.6s ease-out 0.8s backwards;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .version-badge {
            display: inline-block;
            background: var(--glass);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="bg-animation"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">üõ°Ô∏è</div>
            <h1>Atlas Shield</h1>
            <p class="subtitle">Distributed Rate Limiter ‚Ä¢ Token Bucket Algorithm</p>

            <!-- UX-001: Status Badges Row -->
            <div class="status-row">
                <div class="status-badge">
                    <span class="status-dot healthy" id="systemStatusDot"></span>
                    <span id="systemStatus">System Online</span>
                </div>
                <div class="threat-badge low" id="threatBadge">
                    üõ°Ô∏è Threat Level: LOW
                </div>
            </div>
        </header>

        <!-- METRIC-ADV-001: Stats Grid with separated metrics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üíö</div>
                <div class="stat-value success" id="systemHealth">100%</div>
                <div class="stat-label">System Health</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üõ°Ô∏è</div>
                <div class="stat-value info" id="protectionRate">0%</div>
                <div class="stat-label">Protection Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîó</div>
                <div class="stat-value" id="redisStatus">OK</div>
                <div class="stat-label">Redis Status</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-value warning" id="latency">-</div>
                <div class="stat-label">Latency P95</div>
            </div>
        </div>

        <!-- UX-001: Fail-Open Warning -->
        <div class="fail-open-warning" id="failOpenWarning">
            <span class="fail-open-warning-icon">‚ö†Ô∏è</span>
            <div class="fail-open-warning-text">
                <div class="fail-open-warning-title">Fail-Open Mode Active</div>
                <div class="fail-open-warning-desc">
                    <span id="failOpenCount">0</span> requests were allowed without rate limiting due to Redis
                    connection issues.
                </div>
            </div>
        </div>

        <!-- Live Counters - SEC-ADV-001 -->
        <section class="live-section">
            <div class="live-header">
                <div class="live-title">üìä Real-Time Metrics</div>
                <div class="live-indicator">
                    <span class="live-dot"></span>
                    LIVE
                </div>
            </div>
            <div class="counters">
                <div class="counter allowed">
                    <div class="counter-value" id="allowedCount">0</div>
                    <div class="counter-label">‚úÖ Allowed</div>
                </div>
                <div class="counter blocked">
                    <div class="counter-value" id="blockedCount">0</div>
                    <div class="counter-label">üö´ Blocked</div>
                </div>
                <div class="counter threats">
                    <div class="counter-value" id="threatsCount">0</div>
                    <div class="counter-label">‚ö†Ô∏è Threats Neutralized</div>
                </div>
                <div class="counter health">
                    <div class="counter-value" id="bannedClients">0</div>
                    <div class="counter-label">‚õî Banned Clients</div>
                </div>
            </div>
        </section>

        <!-- Endpoints -->
        <section class="endpoints-section">
            <h2 class="section-title">üì° Available Endpoints</h2>

            <div class="endpoint" onclick="testEndpoint('/health')">
                <span class="method get">GET</span>
                <div class="endpoint-info">
                    <div class="endpoint-path">/health</div>
                    <div class="endpoint-desc">System health check</div>
                </div>
                <span class="endpoint-arrow">‚Üí</span>
            </div>

            <div class="endpoint" onclick="testEndpoint('/metrics')">
                <span class="method get">GET</span>
                <div class="endpoint-info">
                    <div class="endpoint-path">/metrics</div>
                    <div class="endpoint-desc">Prometheus Metrics</div>
                </div>
                <span class="endpoint-arrow">‚Üí</span>
            </div>

            <div class="endpoint" onclick="testEndpoint('/api/public')">
                <span class="method get">GET</span>
                <div class="endpoint-info">
                    <div class="endpoint-path">/api/public</div>
                    <div class="endpoint-desc">Rate limit: 100 req / 10s</div>
                </div>
                <span class="endpoint-arrow">‚Üí</span>
            </div>

            <div class="endpoint" onclick="testEndpoint('/api/login-test')">
                <span class="method get">GET</span>
                <div class="endpoint-info">
                    <div class="endpoint-path">/api/login-test</div>
                    <div class="endpoint-desc">Rate limit: 5 req / 5s - Press F5 10x to test!</div>
                </div>
                <span class="endpoint-arrow">‚Üí</span>
            </div>

            <div class="endpoint" onclick="testEndpoint('/api/admin')">
                <span class="method get">GET</span>
                <div class="endpoint-info">
                    <div class="endpoint-path">/api/admin</div>
                    <div class="endpoint-desc">Rate limit: 1000 req / 10s (permissive)</div>
                </div>
                <span class="endpoint-arrow">‚Üí</span>
            </div>
        </section>

        <!-- Action Buttons -->
        <div class="actions">
            <button class="btn btn-primary" onclick="runQuickTest()">‚ö° Quick Test</button>
            <button class="btn btn-danger" onclick="runStressTest()">üî• Stress Test (50 req)</button>
            <button class="btn btn-outline" onclick="refreshMetrics()">üîÑ Refresh Metrics</button>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <strong>Atlas Rate Limiter</strong>
                <span class="version-badge">v1.1.0</span>
            </p>
            <p style="margin-top: 8px;">
                Token Bucket ‚Ä¢ Fail-Open ‚Ä¢ EVALSHA Caching ‚Ä¢ Prometheus Metrics ‚Ä¢ Threat Detection
            </p>
        </footer>
    </div>

    <!-- Response Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Response</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshMetrics();
            setInterval(refreshMetrics, 5000);
        });

        // METRIC-ADV-001 & SEC-ADV-001: Fetch and display advanced metrics
        async function refreshMetrics() {
            try {
                const response = await fetch('/metrics');
                const text = await response.text();

                // Parse Prometheus format
                const allowedMatch = text.match(/atlas_requests_allowed_total\s+(\d+)/);
                const blockedMatch = text.match(/atlas_requests_blocked_total\s+(\d+)/);
                const healthMatch = text.match(/atlas_system_health_score\s+([\d.]+)/);
                const protectionMatch = text.match(/atlas_protection_rate\s+([\d.]+)/);
                const bannedMatch = text.match(/atlas_banned_clients\s+(\d+)/);
                const threatsMatch = text.match(/atlas_threats_neutralized\s+(\d+)/);
                const failOpenMatch = text.match(/atlas_fail_open_events_total\s+(\d+)/);
                const p95Match = text.match(/atlas_response_time_ms{quantile="0.95"}\s+([\d.]+)/);

                // Update counters
                if (allowedMatch) updateCounter('allowedCount', parseInt(allowedMatch[1]));
                if (blockedMatch) updateCounter('blockedCount', parseInt(blockedMatch[1]));
                if (threatsMatch) updateCounter('threatsCount', parseInt(threatsMatch[1]));
                if (bannedMatch) updateCounter('bannedClients', parseInt(bannedMatch[1]));

                // METRIC-ADV-001: Update new metrics
                if (healthMatch) {
                    const health = parseFloat(healthMatch[1]);
                    document.getElementById('systemHealth').textContent = health.toFixed(1) + '%';
                    updateHealthIndicator(health);
                }

                if (protectionMatch) {
                    const protection = parseFloat(protectionMatch[1]);
                    document.getElementById('protectionRate').textContent = protection.toFixed(1) + '%';
                    updateThreatLevel(protection, bannedMatch ? parseInt(bannedMatch[1]) : 0);
                }

                // UX-001: Show fail-open warning
                if (failOpenMatch) {
                    const failOpenCount = parseInt(failOpenMatch[1]);
                    const warning = document.getElementById('failOpenWarning');
                    if (failOpenCount > 0) {
                        warning.classList.add('visible');
                        document.getElementById('failOpenCount').textContent = failOpenCount;
                    } else {
                        warning.classList.remove('visible');
                    }
                }

                if (p95Match) {
                    document.getElementById('latency').textContent = parseFloat(p95Match[1]).toFixed(0) + 'ms';
                }

                // Check health
                const healthRes = await fetch('/health');
                const health = await healthRes.json();
                const redisOk = health.services?.redis === 'healthy';
                document.getElementById('redisStatus').textContent = redisOk ? 'OK' : 'ERROR';
                document.getElementById('redisStatus').className = `stat-value ${redisOk ? 'success' : 'danger'}`;

            } catch (error) {
                console.error('Error fetching metrics:', error);
            }
        }

        // UX-001: Update health indicator
        function updateHealthIndicator(health) {
            const dot = document.getElementById('systemStatusDot');
            const status = document.getElementById('systemStatus');

            if (health >= 99) {
                dot.className = 'status-dot healthy';
                status.textContent = 'System Online';
            } else if (health >= 90) {
                dot.className = 'status-dot warning';
                status.textContent = 'System Degraded';
            } else {
                dot.className = 'status-dot danger';
                status.textContent = 'System Issues';
            }
        }

        // UX-001: Update threat level badge
        function updateThreatLevel(protectionRate, bannedClients) {
            const badge = document.getElementById('threatBadge');
            let level, className;

            if (bannedClients >= 5 || protectionRate >= 50) {
                level = 'CRITICAL';
                className = 'critical';
            } else if (bannedClients >= 2 || protectionRate >= 30) {
                level = 'HIGH';
                className = 'high';
            } else if (bannedClients >= 1 || protectionRate >= 10) {
                level = 'MEDIUM';
                className = 'medium';
            } else {
                level = 'LOW';
                className = 'low';
            }

            badge.className = `threat-badge ${className}`;
            badge.innerHTML = `üõ°Ô∏è Threat Level: ${level}`;
        }

        // Animate counter update
        function updateCounter(id, newValue) {
            const element = document.getElementById(id);
            const currentValue = parseInt(element.textContent) || 0;

            if (newValue !== currentValue) {
                element.classList.add('updating');
                element.textContent = newValue;
                setTimeout(() => element.classList.remove('updating'), 300);
            }
        }

        // Test single endpoint
        async function testEndpoint(path, method = 'GET') {
            showModal('Testing...', '<div style="text-align:center"><div class="spinner" style="margin:20px auto"></div></div>');

            try {
                const start = Date.now();
                const response = await fetch(path, { method });
                const latency = Date.now() - start;

                let data;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }

                const isSuccess = response.ok;
                const statusClass = isSuccess ? 'success' : 'error';
                const statusIcon = isSuccess ? '‚úÖ' : 'üö´';

                // SEC-ADV-001: Show threat indicator if present
                const threatLevel = response.headers.get('X-Threat-Level');
                const threatIndicator = threatLevel ? `<div style="color:#f472b6;margin-top:8px">‚ö†Ô∏è Threat Detected: ${threatLevel}</div>` : '';

                const html = `
                    <div class="response-status ${statusClass}">
                        ${statusIcon} ${response.status} ${response.statusText}
                    </div>
                    ${threatIndicator}
                    <div class="response-details">
                        <div class="detail-row">
                            <span class="detail-label">Endpoint</span>
                            <span class="detail-value">${method} ${path}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Latency</span>
                            <span class="detail-value">${latency}ms</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Rate Limit</span>
                            <span class="detail-value">${response.headers.get('X-RateLimit-Limit') || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Remaining</span>
                            <span class="detail-value">${response.headers.get('X-RateLimit-Remaining') || 'N/A'}</span>
                        </div>
                    </div>
                    <details style="margin-top:15px">
                        <summary style="cursor:pointer;color:rgba(255,255,255,0.6)">View full response</summary>
                        <pre style="background:rgba(0,0,0,0.4);padding:15px;border-radius:10px;margin-top:10px;overflow:auto;max-height:200px;font-size:0.85rem">${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;

                showModal(`Response: ${path}`, html);
                refreshMetrics();

            } catch (error) {
                showModal('Error', `<div class="response-status error">‚ùå ${error.message}</div>`);
            }
        }

        // Quick test
        async function runQuickTest() {
            showModal('Quick Test', '<div style="text-align:center"><div class="spinner" style="margin:20px auto"></div><p>Sending 5 requests...</p></div>');

            const results = { success: 0, blocked: 0 };

            for (let i = 0; i < 5; i++) {
                try {
                    const res = await fetch('/api/public');
                    if (res.status === 200) results.success++;
                    else if (res.status === 429) results.blocked++;
                } catch (e) { }
            }

            const html = `
                <div style="text-align:center;padding:20px">
                    <div style="font-size:3rem;margin-bottom:20px">üìä</div>
                    <div style="display:flex;gap:30px;justify-content:center">
                        <div>
                            <div style="font-size:2.5rem;font-weight:800;color:var(--success)">${results.success}</div>
                            <div style="color:rgba(255,255,255,0.5)">Allowed</div>
                        </div>
                        <div>
                            <div style="font-size:2.5rem;font-weight:800;color:var(--danger)">${results.blocked}</div>
                            <div style="color:rgba(255,255,255,0.5)">Blocked</div>
                        </div>
                    </div>
                </div>
            `;

            showModal('Test Results', html);
            refreshMetrics();
        }

        // Stress test
        async function runStressTest() {
            showModal('Stress Test', '<div style="text-align:center"><div class="spinner" style="margin:20px auto"></div><p>Sending 50 concurrent requests...</p></div>');

            const start = Date.now();
            const promises = [];

            for (let i = 0; i < 50; i++) {
                promises.push(fetch('/api/public').then(r => r.status));
            }

            const statuses = await Promise.all(promises);
            const duration = Date.now() - start;

            const success = statuses.filter(s => s === 200).length;
            const blocked = statuses.filter(s => s === 429).length;
            const rps = (50 / (duration / 1000)).toFixed(1);

            const html = `
                <div style="text-align:center;padding:20px">
                    <div style="font-size:3rem;margin-bottom:20px">üî•</div>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px">
                        <div style="background:rgba(0,0,0,0.3);padding:20px;border-radius:12px">
                            <div style="font-size:2rem;font-weight:800;color:var(--success)">${success}</div>
                            <div style="color:rgba(255,255,255,0.5);font-size:0.9rem">Allowed</div>
                        </div>
                        <div style="background:rgba(0,0,0,0.3);padding:20px;border-radius:12px">
                            <div style="font-size:2rem;font-weight:800;color:var(--danger)">${blocked}</div>
                            <div style="color:rgba(255,255,255,0.5);font-size:0.9rem">Blocked</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:20px;justify-content:center;color:rgba(255,255,255,0.6)">
                        <span>‚è±Ô∏è ${duration}ms</span>
                        <span>üìà ${rps} req/s</span>
                    </div>
                    <p style="margin-top:20px;color:${blocked > 0 ? 'var(--success)' : 'var(--warning)'}">
                        ${blocked > 0 ? '‚úÖ Rate limiter working!' : '‚ö†Ô∏è No blocks detected'}
                    </p>
                </div>
            `;

            showModal('Stress Test Results', html);
            refreshMetrics();
        }

        // Modal functions
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('modalOverlay').classList.remove('active');
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>

</html>